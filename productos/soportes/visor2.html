<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Personalizador 3D - Kreoma3D</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;600;700&display=swap');

:root{
  /* Clamp din√°mico: protege el panel para que no se aplaste cuando sale el teclado del celular */
  --panelH: clamp(280px, 40vh, 350px); 
  --topbarH:55px;
  --fontBig:clamp(16px,4.8vw,22px);
  --fontSemi:clamp(14px,4vw,19px);
  --colorSize:clamp(28px,6vw,38px);
  --radius: 12px;
  
  /* Paleta Futurista Kreoma (Solo interfaz) */
  --bg-dark: #0a0e17;
  --panel-bg: rgba(16, 22, 36, 0.85);
  --neon-orange: #ff6600;
  --neon-cyan: #00f3ff;
  --text-main: #e0e6ed;
  --border-glow: rgba(255, 102, 0, 0.3);
}

/* GENERAL */
*{margin:0;padding:0;box-sizing:border-box;}
body{
  width:100vw; height:100vh; overflow:hidden;
  background: radial-gradient(circle at center, #1a2235 0%, var(--bg-dark) 100%);
  font-family: 'Rajdhani', sans-serif; color: var(--text-main);
}

/* GRID DE FONDO ANIMADO */
#grid-bg {
  position: absolute; inset: 0; z-index: 1; pointer-events: none;
  background-image: 
    linear-gradient(rgba(0, 243, 255, 0.05) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0, 243, 255, 0.05) 1px, transparent 1px);
  background-size: 30px 30px;
  perspective: 500px;
  transform: rotateX(60deg) translateY(-100px) scale(2);
  transform-origin: top;
  animation: gridMove 20s linear infinite;
  opacity: 0.6;
}
@keyframes gridMove {
  0% { background-position: 0 0; }
  100% { background-position: 0 30px; }
}

/* TOPBAR */
.topbar{
  position:fixed; top:0; left:0; right:0; height:var(--topbarH); z-index:30;
  display:flex; align-items:center; justify-content:space-between; padding:0 18px;
  background: linear-gradient(90deg, rgba(10,14,23,0.9) 0%, rgba(26,34,53,0.9) 100%);
  border-bottom: 2px solid var(--neon-orange);
  box-shadow: 0 0 15px var(--border-glow);
  backdrop-filter: blur(10px);
}
.topbar img{ height: 40px; filter: drop-shadow(0 0 5px var(--neon-orange)); cursor:pointer; }
.topbar h1{
  font-family: 'Orbitron', sans-serif; font-size:clamp(12px,4vw,16px); font-weight:700; text-align:center;
  flex:1; margin:0 12px; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; 
  color: var(--neon-cyan); text-transform: uppercase; letter-spacing: 1px;
}
.topbar nav a{ 
  color: #fff; text-decoration:none; margin-left:16px; font-weight:600; font-size: 14px;
  transition: 0.3s;
}
.topbar nav a:hover { color: var(--neon-cyan); text-shadow: 0 0 8px rgba(0,243,255,0.4); }

/* VISOR */
#visor{ position:fixed; top:var(--topbarH); left:0; right:0; bottom:var(--panelH); height:auto; overflow:hidden; z-index: 5; }
#visor-bg{ position:absolute; inset:0; background:url("logo_kreoma.png") center center no-repeat; background-size:70vmin; opacity:.05; pointer-events:none; z-index:1; }
#canvas-container{ position:absolute; inset:0; z-index:10; }

/* PANEL DE CONTROL (GLASSMORPHISM) */
#panel{
  position:fixed; bottom:0; left:0; right:0; height:var(--panelH); z-index:20;
  background: var(--panel-bg); backdrop-filter: blur(15px);
  border-top: 1px solid rgba(0, 243, 255, 0.2);
  padding:clamp(12px,3vw,20px); display:flex; flex-direction:column; gap:12px;
  overflow-y:auto; box-shadow: 0 -10px 30px rgba(0,0,0,0.5);
  scroll-behavior: smooth;
}
#panel > * { flex-shrink: 0; }
#panel::-webkit-scrollbar { width: 6px; }
#panel::-webkit-scrollbar-thumb { background: var(--neon-orange); border-radius: 10px; }

/* AYUDA VISUAL FUTURISTA */
#instruccion {
  background: rgba(255, 102, 0, 0.1);
  color: var(--neon-orange);
  padding: 8px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 700;
  text-align: center;
  border: 1px dashed var(--neon-orange);
  box-shadow: 0 0 10px rgba(255, 102, 0, 0.1);
}

/* TABS (AJUSTADOS PARA VERSE TODOS A LA VEZ) */
#tabs{ display:flex; gap:5px; flex-wrap:wrap; justify-content:center; }
.tab{
  flex: 1 1 auto; /* Permite que se encojan o estiren para rellenar el espacio equitativamente */
  padding:8px 4px; border-radius:4px; 
  background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
  font-family: 'Orbitron', sans-serif; 
  font-size:clamp(10px, 2.5vw, 12px); /* Letra que se ajusta a pantallas peque√±as */
  font-weight:700; text-align:center; 
  cursor:pointer; transition:all .3s; text-transform: uppercase; letter-spacing: 0.5px;
  color: #aaa; position: relative; overflow: hidden;
  white-space: nowrap; /* Evita que el nombre del bot√≥n se parta en dos l√≠neas */
}
.tab::before { content: ''; position: absolute; bottom: 0; left: 0; width: 0%; height: 2px; background: var(--neon-cyan); transition: 0.3s; }
.tab:hover { background: rgba(0,243,255,0.1); color: #fff; }
.tab.activo{ 
  background: rgba(0,243,255,0.15); color: var(--neon-cyan); border-color: var(--neon-cyan);
  box-shadow: 0 0 10px rgba(0,243,255,0.2) inset;
}
.tab.activo::before { width: 100%; }

/* COLORES */
#bloque-colores h3{ font-size:var(--fontSemi); font-weight:700; margin-bottom:5px; color: var(--neon-cyan); }
#paleta{ display:flex; flex-wrap:wrap; gap:10px; justify-content: center; }
.color{
  width:var(--colorSize); height:var(--colorSize); border-radius:50%; 
  border: 2px solid rgba(255,255,255,0.2); cursor:pointer; 
  transition:all .2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  position: relative;
}
.color::after {
  content: ''; position: absolute; inset: -4px; border-radius: 50%; border: 2px solid transparent; transition: 0.3s;
}
.color:hover { transform: scale(1.15); border-color: #fff; }
.color.sel{ transform: scale(1.2); border-color: var(--neon-cyan); }
.color.sel::after { border-color: var(--neon-cyan); box-shadow: 0 0 10px var(--neon-cyan); }

/* LOGO BLOCK */
#logo-block{ display:none; flex-direction:column; gap:8px; background:rgba(0,0,0,0.3); padding:12px; border-radius:8px; border: 1px dashed rgba(255,255,255,0.1); }
.logo-type-switch{ display:flex; gap:15px; margin-bottom:5px; justify-content: center;}
.logo-type-switch label{ display:flex; align-items:center; gap:6px; font-size:var(--fontSemi); cursor:pointer; font-weight:600; color: #ccc; }
.logo-type-switch input[type="radio"] { accent-color: var(--neon-cyan); transform: scale(1.2); }

select, input[type="text"]{ 
  width:100%; padding:12px; border-radius:6px; 
  background: rgba(0,0,0,0.5); border: 1px solid rgba(0,243,255,0.3); 
  font-family: 'Rajdhani', sans-serif; font-size:16px; text-transform: uppercase; 
  color: var(--neon-cyan); font-weight: 600; outline: none; transition: 0.3s;
}
select:focus, input[type="text"]:focus { border-color: var(--neon-cyan); box-shadow: 0 0 15px rgba(0,243,255,0.3); }
select option { background: var(--bg-dark); color: #fff; }

/* BOT√ìN WHATSAPP - REACTOR CORE */
#enviarWhatsApp{
  margin-top:auto; width:100%; padding:14px; 
  background: linear-gradient(45deg, #128C7E, #25D366); 
  color:#fff; border:none; border-radius:8px; 
  font-family: 'Orbitron', sans-serif; font-size:16px; font-weight:900; 
  cursor:pointer; text-transform: uppercase; letter-spacing: 1px;
  position: relative; overflow: hidden; z-index: 1;
  box-shadow: 0 0 20px rgba(37, 211, 102, 0.4);
  transition: all 0.3s;
}
#enviarWhatsApp::before {
  content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
  transform: skewX(-20deg); z-index: -1; animation: shine 3s infinite;
}
@keyframes shine { 100% { left: 200%; } }
#enviarWhatsApp:hover { transform: translateY(-2px); box-shadow: 0 5px 25px rgba(37, 211, 102, 0.6); }
#enviarWhatsApp:active { transform: scale(0.98); }

.hidden{ display:none; }

@media(min-width:900px){ :root{ --panelH:40vh; } #panel{ padding:20px 40px; } }
</style>
</head>

<body>

<div id="grid-bg"></div>

<div class="topbar">
  <a href="../../index.html"><img src="logo_kreoma.png" alt="Kreoma3D"></a>
  <h1>Personalizador ‚Ä¢ Soporte 3 en 1</h1>
  <nav><a href="../index.html">Inicio</a></nav>
</div>

<div id="visor">
  <div id="visor-bg"></div>
  <div id="canvas-container"></div>
</div>

<div id="panel">
  <p id="instruccion">üëâ Paso 1: Toca una de las opciones de abajo</p>

  <div id="tabs">
    <div class="tab activo" data-grupo="base"> Base</div>
    <div class="tab" data-grupo="superior"> Superior</div>
    <div class="tab" data-grupo="insert"> Insertos</div>
    <div class="tab" data-grupo="logo">‚úçÔ∏è Nombre/Logo</div>
  </div>

  <div id="bloque-colores">
    <div id="paleta"></div>
  </div>

  <div id="logo-block">
    <div class="logo-type-switch">
      <label><input type="radio" name="tipoLogo" value="catalogo" checked> Logo</label>
      <label><input type="radio" name="tipoLogo" value="texto"> Nombre</label>
    </div>
    <div id="cont-select-logo"><select id="logo-select"></select></div>
    <div id="cont-input-text" class="hidden">
      <input type="text" id="custom-text" placeholder="ESCRIBE AQU√ç TU NOMBRE" maxlength="12">
    </div>
  </div>

  <button id="enviarWhatsApp" type="button">‚úÖ PEDIR POR WHATSAPP</button>
</div>

<script type="importmap">
  { "imports": { "three": "https://unpkg.com/three@0.158.0/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.158.0/examples/jsm/" } }
</script>

<script type="module">
import * as THREE from 'three';
import { STLLoader } from 'three/addons/loaders/STLLoader.js';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import { FontLoader } from 'three/addons/loaders/FontLoader.js';
import { TextGeometry } from 'three/addons/geometries/TextGeometry.js';

/* CONFIGURACI√ìN ESCENA EXACTA A LA ORIGINAL */
const canvasContainer = document.getElementById("canvas-container");
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, canvasContainer.clientWidth/canvasContainer.clientHeight, 0.1, 10000);

camera.position.set(-130,0,130);

const renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
renderer.setSize(canvasContainer.clientWidth, canvasContainer.clientHeight);
canvasContainer.appendChild(renderer.domElement);

/* ILUMINACI√ìN ORIGINAL RESTAURADA (Colores exactos de PLA) */
const hemi = new THREE.HemisphereLight(0xffffff,0x777777,1.3); scene.add(hemi);
const dir = new THREE.DirectionalLight(0xffffff,0.85); dir.position.set(1,1,1); scene.add(dir);
scene.add(new THREE.AmbientLight(0xffffff,0.35));

const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true; controls.dampingFactor = 0.06;
controls.autoRotate = true; 
controls.autoRotateSpeed = 0.5;

const world = new THREE.Group();
world.position.y = -140; world.position.x = 175;
scene.add(world);

const STL_POS = { x: 11, y: -15, z: -5 };
const STL_ROT = { x: Math.PI, y: 0, z: Math.PI };
const TXT_POS = { x: -156, y: 103, z: -17 };
const TXT_ROT = { x: 1.5, y: 5.3, z: 3.1 };

const loader = new STLLoader();
const fontLoader = new FontLoader();
let fuenteCargada = null;
const FONT_URL = 'https://unpkg.com/three@0.158.0/examples/fonts/helvetiker_bold.typeface.json';

const piezas = {
  base: {file:"Helm-Wandhalter.stl", mesh:null},
  superior: {file:"Helm-Halter.stl", mesh:null},
  inserts: ["Insert1.stl","Insert2.stl","Insert3.stl","Insert4.stl","Insert5.stl"],
  insertMeshes: [],
  logo: { mesh:null }
};

let grupoActivo = "base";
let modoLogo = "catalogo";
const seleccion = {
  base: {c:"#000000"}, superior: {c:"#ff8000"}, insert: {c:"#ff8000"}, logo: {c:"#ff8000"}
};

/* MATERIAL ORIGINAL RESTAURADO: MeshStandardMaterial */
function cargarEstructura(){
  loader.load(piezas.base.file, g=>{
    const m=new THREE.Mesh(g,new THREE.MeshStandardMaterial({color:seleccion.base.c}));
    m.rotation.set(Math.PI,0,Math.PI); world.add(m); piezas.base.mesh=m;
  });
  loader.load(piezas.superior.file,g=>{
    const m=new THREE.Mesh(g,new THREE.MeshStandardMaterial({color:seleccion.superior.c}));
    m.rotation.set(Math.PI,0,Math.PI); world.add(m); piezas.superior.mesh=m;
  });
  piezas.inserts.forEach(f=>{
    loader.load(f,g=>{
      const m=new THREE.Mesh(g,new THREE.MeshStandardMaterial({color:seleccion.insert.c}));
      m.rotation.set(Math.PI,0,Math.PI); world.add(m); piezas.insertMeshes.push(m);
    });
  });
  fontLoader.load(FONT_URL, (font) => { fuenteCargada = font; });
  cargarLogoSTL("logoYamaha.stl");
}

function limpiarLogoAnterior(){
  if(piezas.logo.mesh){
    world.remove(piezas.logo.mesh);
    piezas.logo.mesh = null;
  }
}

function cargarLogoSTL(archivo){
  limpiarLogoAnterior();
  if(!archivo) return;
  loader.load(archivo, g=>{
    const m=new THREE.Mesh(g,new THREE.MeshStandardMaterial({color:seleccion.logo.c}));
    m.position.set(STL_POS.x, STL_POS.y, STL_POS.z);
    m.rotation.set(STL_ROT.x, STL_ROT.y, STL_ROT.z);
    world.add(m); piezas.logo.mesh=m;
  });
}

function generarTexto3D(textoString){
  limpiarLogoAnterior();
  if(!fuenteCargada || !textoString) return;
  const textoMayus = textoString.toUpperCase();
  const mat = new THREE.MeshStandardMaterial({color: seleccion.logo.c});
  const grupoTexto = new THREE.Group();
  let offsetActual = 0;
  
  textoMayus.split('').forEach(letra => {
    if(letra === " "){ offsetActual += 10; return; }
    const geo = new TextGeometry(letra, { font: fuenteCargada, size: 18, height: 2, curveSegments: 4, bevelEnabled: true, bevelThickness: 0.5, bevelSize: 0.3 });
    geo.computeBoundingBox();
    const ancho = geo.boundingBox.max.x - geo.boundingBox.min.x;
    geo.translate(offsetActual, 0, 0);
    grupoTexto.add(new THREE.Mesh(geo, mat));
    offsetActual += ancho + 2;
  });
  
  const centroX = -offsetActual / 2;
  grupoTexto.children.forEach(c => c.geometry.translate(centroX, -9, 0));
  grupoTexto.position.set(TXT_POS.x, TXT_POS.y, TXT_POS.z);
  grupoTexto.rotation.set(TXT_ROT.x, TXT_ROT.y, TXT_ROT.z);
  world.add(grupoTexto); piezas.logo.mesh = grupoTexto;
}

/* INTERFAZ Y L√ìGICA DE INSTRUCCIONES ORIGINAL RESTAURADA */
const instruccionTxt = document.getElementById("instruccion");
const colores=[
  {n:"Amarillo",c:"#fff700"}, {n:"Blanco",c:"#ffffff"},{n:"Verde Lim√≥n",c:"#68fd3f"},
  {n:"Negro",c:"#000000"}, {n:"Azul",c:"#0000ff"}, {n:"Oro",c:"#ffff94"},
  {n:"Verde",c:"#2e7d32"}, {n:"Rosado",c:"#ff8783"}, {n:"Morado",c:"#7f00b2"}, {n:"Azul Cielo",c:"#80caff"},
  {n:"Caf√©",c:"#8b4513"}, {n:"Rojo",c:"#ff0000"}, {n:"Gris",c:"#8d8d8d"}, {n:"Naranja",c:"#ff8000"},
  {n:"Menta",c:"#9ce0db"}, {n:"Madera",c:"#ffe8d0"}
];

function crearPaleta(){
  const paleta = document.getElementById("paleta");
  colores.forEach(col=>{
    const el=document.createElement("div");
    el.className="color"; el.dataset.hex=col.c; el.style.background=col.c;
    el.addEventListener("click",()=>{ 
      aplicarColor(grupoActivo, col.c); 
      resaltarSeleccion();
      instruccionTxt.innerText = "‚úÖ ¬°Bien! Ahora elige otra parte o dale a WhatsApp";
    });
    paleta.appendChild(el);
  });
  resaltarSeleccion();
}

/* L√ìGICA DE COLOR CON REFLEJOS ORIGINALES RESTAURADA */
function aplicarColor(grupo, hex){
  seleccion[grupo].c = hex;
  
  const esOro = (hex.toLowerCase() === "#ffff94");
  const valorMetal = esOro ? 0.4 : 0.0;
  const valorRugosidad = esOro ? 0.1 : 0.8;

  const actualizarMaterial = (mesh) => {
    if(!mesh) return;
    if(mesh.isGroup) {
      mesh.children.forEach(c => {
        c.material.color.set(hex);
        c.material.metalness = valorMetal;
        c.material.roughness = valorRugosidad;
      });
    } else {
      mesh.material.color.set(hex);
      mesh.material.metalness = valorMetal;
      mesh.material.roughness = valorRugosidad;
    }
  };

  if(grupo==="base") actualizarMaterial(piezas.base.mesh);
  if(grupo==="superior") actualizarMaterial(piezas.superior.mesh);
  if(grupo==="insert") piezas.insertMeshes.forEach(m => actualizarMaterial(m));
  if(grupo==="logo") actualizarMaterial(piezas.logo.mesh);
}

function resaltarSeleccion(){
  const hexSel=seleccion[grupoActivo].c;
  document.querySelectorAll(".color").forEach(el=>{
    if(el.dataset.hex===hexSel) el.classList.add("sel"); else el.classList.remove("sel");
  });
}

const tabs = document.querySelectorAll(".tab");
tabs.forEach(tab=>{
  tab.addEventListener("click",()=>{
    tabs.forEach(t=>t.classList.remove("activo"));
    tab.classList.add("activo");
    grupoActivo=tab.dataset.grupo;
    document.getElementById("logo-block").style.display = (grupoActivo==="logo") ? "flex" : "none";
    resaltarSeleccion();
    
    if(grupoActivo === "logo") instruccionTxt.innerText = "üëá Paso 2: Escribe tu nombre o elige un Logo";
    else instruccionTxt.innerText = "üëá Paso 2: Toca un color para esta pieza";
  });
});

/* LISTA LOGOS */
const logos=[{n:"Yamaha",f:"logoYamaha.stl"},{n:"Sin logo",f:""},{n:"Nmax",f:"logoNmax.stl"},{n:"V-Strom",f:"logoVstrom.stl"},{n:"Ktm",f:"logoKtm.stl"},{n:"FOX",f:"logoFox.stl"},{n:"Monster",f:"logoMonster.stl"},{n:"Nike",f:"logoNike.stl"},{n:"Honda",f:"logoHonda.stl"},{n:"Suzuki",f:"logoSuzuki.stl"},{n:"Pulsar",f:"logoPulsar.stl"},{n:"AKT",f:"logoAKT.stl"},{n:"Royal Enfield",f:"logoRoyal.stl"},{n:"Dominar",f:"logoDominar.stl"},{n:"Kawasaki",f:"logoKawasaki.stl"},{n:"Discover",f:"logoDiscover.stl"}];
const logoSelect = document.getElementById('logo-select');
logos.forEach(l=>{
  const opt=document.createElement("option"); opt.value=l.f; opt.textContent=l.n;
  logoSelect.appendChild(opt);
});
logoSelect.addEventListener("change",()=>{ cargarLogoSTL(logoSelect.value); });

const customInput = document.getElementById('custom-text');
customInput.addEventListener('input', (e)=>{ generarTexto3D(e.target.value); });

/* SCROLL AUTOM√ÅTICO AL TOCAR EL INPUT */
customInput.addEventListener('focus', () => {
  setTimeout(() => { document.getElementById('panel').scrollTop = document.getElementById('panel').scrollHeight; }, 300);
});

document.querySelectorAll('input[name="tipoLogo"]').forEach(r => {
  r.addEventListener('change', (e) => {
    modoLogo = e.target.value;
    document.getElementById('cont-select-logo').classList.toggle('hidden', modoLogo!=='catalogo');
    document.getElementById('cont-input-text').classList.toggle('hidden', modoLogo!=='texto');
    if(modoLogo==='catalogo') cargarLogoSTL(logoSelect.value); else generarTexto3D(customInput.value);
    
    if(modoLogo === 'texto') {
      setTimeout(() => { document.getElementById('panel').scrollTop = document.getElementById('panel').scrollHeight; }, 100);
    }
  });
});

/* DETENER GIRO AL TOCAR LA PANTALLA */
controls.addEventListener('start', () => { controls.autoRotate = false; });

/* WHATSAPP + CAPTURA LEAD EN ERP (INTACTO) */
function nombreColor(hex) {
  const c = colores.find(x => x.c.toLowerCase() === hex.toLowerCase());
  return c ? c.n : "Personalizado";
}

function enviarLeadNoBloqueante(payload) {
  const API_URL = "https://www.fpc.com.co/Kreoma/api/lead_create.php";
  const API_KEY = "f7N#z2K9v$Lp8Qx@m5W&1jR*tS6uB4cY9gH3eD!aV0n";

  try {
    if (navigator.sendBeacon) {
      const urlConKey = API_URL + "?k=" + encodeURIComponent(API_KEY);
      const blob = new Blob([JSON.stringify(payload)], { type: "text/plain;charset=UTF-8" });
      const ok = navigator.sendBeacon(urlConKey, blob);
      if (ok) return;
    }
  } catch (e) {}

  try {
    fetch(API_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-KREOMA-KEY": API_KEY
      },
      body: JSON.stringify(payload),
      keepalive: true,
      mode: "cors"
    }).catch(()=>{});
  } catch (e) {}
}

document.getElementById("enviarWhatsApp").addEventListener("click", () => {
  const baseC = nombreColor(seleccion.base.c);
  const supC  = nombreColor(seleccion.superior.c);
  const insC  = nombreColor(seleccion.insert.c);
  const logC  = nombreColor(seleccion.logo.c);

  let infoLogo = "";
  let logoModo = "";
  let logoValor = "";

  if (modoLogo === "catalogo") {
    const nombreL = logoSelect.selectedOptions[0]?.textContent || "Ninguno";
    infoLogo = `Logo cat√°logo: ${nombreL}`;
    logoModo = "catalogo";
    logoValor = nombreL;
  } else {
    const texto = (customInput.value || "").trim().toUpperCase() || "Sin texto";
    infoLogo = `Nombre personalizado: "${texto}"`;
    logoModo = "texto";
    logoValor = texto;
  }

  const msg = `Hola Kreoma3D! üëã\nQuiero mi soporte personalizado:\n‚Ä¢ Base: ${baseC}\n‚Ä¢ Superior: ${supC}\n‚Ä¢ Insertos: ${insC}\n‚Ä¢ ${infoLogo} (Color: ${logC})`;

  const waUrl = `https://wa.me/573332395481?text=${encodeURIComponent(msg)}`;
  const waWin = window.open(waUrl, "_blank");

  if (!waWin) { window.location.href = waUrl; }

  const payload = {
    origen: "visor_soporte_v1",
    producto_key: "SOPORTE_3EN1",
    base_color: baseC,
    superior_color: supC,
    insert_color: insC,
    logo_color: logC,
    logo_modo: logoModo,
    logo_valor: logoValor,
    mensaje_whatsapp: msg
  };

  setTimeout(() => enviarLeadNoBloqueante(payload), 0);
});

function animate(){ requestAnimationFrame(animate); controls.update(); renderer.render(scene,camera); }
animate();
window.addEventListener("resize",()=>{
  renderer.setSize(canvasContainer.clientWidth, canvasContainer.clientHeight);
  camera.aspect=canvasContainer.clientWidth/canvasContainer.clientHeight;
  camera.updateProjectionMatrix();
});
cargarEstructura(); crearPaleta();
</script>
</body>
</html>
